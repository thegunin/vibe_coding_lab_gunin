# Telegram Feedback Bot

Бот для сбора командной обратной связи с ролями «руководитель» и «сотрудник». Реализованы:
– вход с демо-аккаунтами и привязкой к Telegram user_id,
– создание вопросов руководителем и отслеживание ответов,
– ответы сотрудников с оценкой 1–5 и возможностью изменить, пока вопрос активен,
– мгновенные уведомления руководителю и просмотр истории уведомлений,
– отчёты с агрегированной статистикой и экспортом CSV,
– хранение данных в SQLite, конфигурация через `.env`, логирование стандартным `logging`.

## Быстрый старт

1. Установите Python 3.10+.
2. Создайте виртуальное окружение и активируйте его.
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Скопируйте `.env.example` в `.env` и задайте значения:
   * `TELEGRAM_BOT_TOKEN` — токен вашего бота.
   * `PASSWORD_SALT` — произвольная (лучше случайная) строка.
   * `DATABASE_PATH` — путь к SQLite-файлу (по умолчанию `feedback_bot.db` в корне проекта).
5. Запустите бота:
   ```bash
   python -m src.bot
   ```

При первом старте база создаётся автоматически и заполняется учётками:

| Роль         | Логин       | Пароль            |
|--------------|-------------|-------------------|
| Руководитель | manager     | manager-password  |
| Сотрудник    | employee-1  | employee-1        |
| Сотрудник    | employee-2  | employee-2        |
| Сотрудник    | employee-3  | employee-3        |

После входа Telegram user_id остаётся закреплённым до команды «Сменить аккаунт».

## Основные сценарии

- `/start` показывает основное меню с кнопками ReplyKeyboard по роли.
- Сотрудник:
  * `Вопросы` — список активных неотвеченных вопросов с inline-кнопками `[1–5]`.
  * `Мои ответы` — история с возможностью изменить ответ (пока вопрос активен).
- Руководитель:
  * `Создать вопрос` — ввод текста и мгновенное появление у сотрудников.
  * `Отчёты` — вопросы батчами по 10, детали, CSV и переключение статуса.
  * `Уведомления` — история уведомлений с отметкой о прочтении.

Ответы сотрудников автоматически создают уведомления, сохраняются в базе и шлются всем залогиненным руководителям.

## Полезные команды

- `Отмена` — прервать текущий диалог (например, ввод вопроса или логина).
- `Сменить аккаунт` — отвязать Telegram user_id от привязанной учётки.

## Структура проекта

- `src/config.py` — загрузка конфигурации из `.env`.
- `src/security.py` — SHA256-хеширование паролей.
- `src/database.py` — создание схемы SQLite, запросы и уведомления.
- `src/bot.py` — Telegram-бизнес-логика на `python-telegram-bot`.
